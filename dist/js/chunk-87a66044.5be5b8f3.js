(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-87a66044"],{"267b":function(e,t,s){"use strict";s("4a4e")},"4a4e":function(e,t,s){},"55fb":function(e,t,s){},"73ad":function(e,t,s){},"7d3a":function(e,t,s){"use strict";s("55fb")},a434:function(e,t,s){"use strict";var n=s("23e7"),i=s("23cb"),o=s("a691"),a=s("50c4"),r=s("7b0b"),c=s("65f0"),l=s("8418"),u=s("1dde"),d=u("splice"),m=Math.max,h=Math.min,v=9007199254740991,f="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var s,n,u,d,g,p,w=r(this),b=a(w.length),y=i(e,b),x=arguments.length;if(0===x?s=n=0:1===x?(s=0,n=b-y):(s=x-2,n=h(m(o(t),0),b-y)),b+s-n>v)throw TypeError(f);for(u=c(w,n),d=0;d<n;d++)g=y+d,g in w&&l(u,d,w[g]);if(u.length=n,s<n){for(d=y;d<b-n;d++)g=d+n,p=d+s,g in w?w[p]=w[g]:delete w[p];for(d=b;d>b-n+s;d--)delete w[d-1]}else if(s>n)for(d=b-n;d>y;d--)g=d+n-1,p=d+s-1,g in w?w[p]=w[g]:delete w[p];for(d=0;d<s;d++)w[d+y]=arguments[d+2];return w.length=b-n+s,u}})},bafb:function(e,t,s){"use strict";s("73ad")},c740:function(e,t,s){"use strict";var n=s("23e7"),i=s("b727").findIndex,o=s("44d2"),a="findIndex",r=!0;a in[]&&Array(1)[a]((function(){r=!1})),n({target:"Array",proto:!0,forced:r},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o(a)},dd1f:function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"cont"},[1==e.admin?s("h3",{staticClass:"text-center"},[e._v("بدأ بث مباشر جديد")]):e._e(),1!=e.admin?s("h3",{staticClass:"text-center"},[e._v("بث مباشر")]):e._e(),s("hr"),1==e.admin?s("div",{staticClass:"admin-control"},[s("div",{staticClass:"row align-items-center",attrs:{dir:"rtl"}},[s("div",{staticClass:"col-md-6"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.stage,expression:"stage"}],staticClass:"form-control",attrs:{disabled:e.live},on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.stage=t.target.multiple?s:s[0]},e.changeStage]}},e._l(e.$store.getters.stages,(function(t){return s("option",{key:t.value,domProps:{value:t.value}},[e._v(" "+e._s(t.text)+" ")])})),0)]),s("div",{staticClass:"col-md-6 butt"},[e.live?e._e():s("button",{staticClass:"btn w-100 start",on:{click:e.startLive}},[e._v("ابدأ")]),e.live?s("button",{staticClass:"btn btn-danger end w-100",on:{click:e.stopLive}},[e._v(" اوقف البث ")]):e._e()])])]):e._e(),1==e.admin?s("div",{staticClass:"w-100 online-users"},[s("hr"),s("div",{staticClass:"row users"},e._l(e.stage_users.filter((function(t){return"online"==e.isOnline(t._id)})),(function(t,n){return s("div",{key:n,staticClass:"col-md-2 user",on:{click:function(s){e.userToDraw=t._id}}},[s("i",{staticClass:"fa fa-user"}),s("span",{staticClass:"state",class:e.isOnline(t._id)},[e._v(e._s(e.isOnline(t._id)))]),s("div",{staticClass:"name"},[e._v(e._s(t.fullname))]),t._id==e.userToDraw?s("p",{staticStyle:{background:"green",color:"#fff"}},[e._v(" draw allowed ")]):e._e()])})),0)]):e._e(),s("div",{staticClass:"timer m-auto"},[e._v(e._s(e.time))]),s("hr"),s("div",{staticClass:"con row"},[s("div",{staticClass:"col-md-8",staticStyle:{position:"relative",height:"90vh"}},[s("video-iframe",{attrs:{src:"https://www.youtube.com/embed/live_stream?channel="+e.youtubeSecret}})],1),s("div",{staticClass:"comments",class:e.board?"col-md-12":"col-md-4"},[e._m(0),s("div",{staticClass:"messages"},e._l(e.messages,(function(t,n){return s("div",{key:n,staticClass:"message"},[s("div",{staticClass:"name"},[e._v(" "+e._s(t.name)),s("i",{staticClass:"fa fa-user",staticStyle:{"margin-left":"4px"}})]),s("div",{staticClass:"text"},[e._v(e._s(t.text))])])})),0),s("hr"),s("div",{staticClass:"send d-flex align-items-center"},[s("div",{staticClass:"flex-grow-1"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"form-control w-100",staticStyle:{"border-radius":"8px"},attrs:{placeholder:"ارسل رسالة"},domProps:{value:e.message},on:{keydown:function(t){13==t.keyCode&&e.sendMessage()},input:function(t){t.target.composing||(e.message=t.target.value)}}})]),s("div",{staticClass:"ml-1"},[s("i",{staticClass:"fa fa-send",staticStyle:{cursor:"pointer","font-size":"1.4rem"},on:{click:e.sendMessage}})])])])]),s("hr"),s("br"),s("br"),s("app-iframe",{attrs:{src:e.$store.getters.expVideos.live}})],1)},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"header"},[s("h5",{staticClass:"text-center"},[e._v("الشات الجماعي")]),s("hr")])}],o=(s("c740"),s("caad"),s("a434"),s("d3b7"),s("ac1f"),s("25f0"),s("2532"),s("5319"),s("1276"),s("2909")),a=(s("96cf"),s("1da1")),r=s("56d7"),c=s("bc3a"),l=s.n(c),u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"d-flex flex-column align-items-center justify-content-center"},[s("div",{staticClass:"options row w-100 p-2 bg-dark m-4",attrs:{dir:"rtl"}},[s("div",{staticClass:"col-md-1"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.color,expression:"color"}],staticClass:"form-control",staticStyle:{height:"50px",width:"70px"},attrs:{type:"color"},domProps:{value:e.color},on:{input:function(t){t.target.composing||(e.color=t.target.value)}}})]),s("div",{staticClass:"col-md-1"},[s("div",{staticStyle:{width:"50px",height:"50px",cursor:"pointer",background:"#fff"},on:{click:e.erease}},[s("i",{staticClass:"fa fa-rubber"})])]),s("div",{staticClass:"col-md-1"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.lineWidth,expression:"lineWidth"}],staticClass:"form-control",staticStyle:{height:"50xp"},attrs:{type:"range",min:"1",max:"25",value:"5"},domProps:{value:e.lineWidth},on:{__r:function(t){e.lineWidth=t.target.value}}})]),e.drawAllowed?s("div",{staticClass:"col-md-2"},[s("h5",{staticStyle:{color:"#fff"}},[e._v("مسموح لك بالكتابة")])]):e._e()]),s("canvas",{attrs:{id:"canvas",width:"1500",height:"800"},on:{mousedown:e.handleMouseDown,mouseup:e.handleMouseUp,mousemove:e.handleMouseMove}})])},d=[],m={props:["io","userToDraw"],mounted:function(){var e=this;1==this.role&&(this.drawAllowed=!0);var t=document.getElementById("canvas");this.ctx=t.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,Object(r["socket"])().on("mouse-down",(function(t){t.userId!==e.userId&&e.mouseDownAction(t)})),Object(r["socket"])().on("mouse-up",(function(t){t.userId!=e.userId&&(e.mouse.down=!1)})),Object(r["socket"])().on("erease",(function(t){t.userId!=e.userId&&e.ctx.clearRect(0,0,1e3,1e3)})),Object(r["socket"])().on("mouse-move",(function(t){t.userId!=e.userId&&e.mouseMoveAction(t)})),Object(r["socket"])().on("user-to-draw",(function(t){1!=e.role&&(t==e.userId?e.drawAllowed=!0:e.drawAllowed=!1)}))},data:function(){return{ctx:null,color:"#000",lineWidth:2,drawAllowed:!1,mouse:{current:{x:0,y:0},previous:{x:0,y:0},down:!1}}},computed:{currentMouse:function(){var e=document.getElementById("canvas"),t=e.getBoundingClientRect();return console.log(this.mouse.current.y-t.top),{x:this.mouse.current.x-t.left,y:this.mouse.current.y-t.top}},stage:function(){return this.$store.getters.stage},role:function(){return this.$store.getters.role},userId:function(){return this.$store.getters.userId}},watch:{userToDraw:function(e){console.log(e),1==this.role&&Object(r["socket"])().emit("user-to-draw",{stage:this.stage,userId:e})}},methods:{draw:function(e){this.mouse.down&&(this.ctx.strokeStyle=this.color,e.color&&(this.ctx.strokeStyle=e.color),this.ctx.lineWidth=this.lineWidth,e.color&&(this.ctx.lineWidth=e.lineWidth),this.ctx.lineTo(this.currentMouse.x,this.currentMouse.y),this.ctx.stroke())},handleMouseDown:function(e){this.drawAllowed&&(this.mouseDownAction(e),Object(r["socket"])().emit("mouse-down",{stage:this.stage,userId:this.userId,clientX:e.clientX,clientY:e.clientY}))},mouseDownAction:function(e){var t=document.getElementById("canvas").getBoundingClientRect();console.log(t),window.scrollTo(0,1250),this.mouse.down=!0,this.ctx.closePath(),this.ctx.beginPath(),this.mouse.current={x:e.clientX,y:e.clientY},this.ctx.moveTo(this.currentMouse.x,this.currentMouse.y)},handleMouseUp:function(){this.drawAllowed&&(this.mouse.down=!1,Object(r["socket"])().emit("mouse-up",{stage:this.stage,userId:this.userId}))},handleMouseMove:function(e){this.mouse.down&&this.drawAllowed&&(this.mouseMoveAction(e),Object(r["socket"])().emit("mouse-move",{stage:this.stage,userId:this.userId,clientX:e.clientX,clientY:e.clientY,color:this.color,lineWidth:this.lineWidth}))},mouseMoveAction:function(e){this.mouse.down&&(this.mouse.current={x:e.clientX,y:e.clientY},this.draw(e))},erease:function(){1==this.role&&(this.ctx.clearRect(0,0,1e3,1e3),Object(r["socket"])().emit("erease",{stage:this.stage,userId:this.userId}))}}},h=m,v=(s("7d3a"),s("2877")),f=Object(v["a"])(h,u,d,!1,null,"1214e3ce",null),g=f.exports,p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg-light p-0",attrs:{id:""}},[s("textarea",{staticStyle:{position:"fixed",top:"-100vh"},attrs:{readonly:"",id:"textarea"}}),s("iframe",{ref:"video",style:{display:e.played?"block":"none"},attrs:{id:"video",width:"100%",height:"100%",src:e.src+"&theme=dark&autoplay=1&autohide=0&cc_load_policy=1&modestbranding=1&fs=0&showinfo=0&rel=0&iv_load_policy=3&mute=0&loop=0&enablejsapi=1&version=3&playerapiid=ytplayer&controls=1&mode=opaque&&showinfo=0;",allow:"autoplay;",sandbox:"allow-forms allow-scripts allow-pointer-lock allow-same-origin allow-top-navigation"}}),s("div",{staticClass:"cover-top",on:{click:e.toggleVideoPlay}}),s("div",{ref:"ctrl",staticClass:"ctrl_bar"},[""!=e.src?s("div",{staticClass:"ctrl_btns bg-dark"},[s("div",{staticClass:"ctrl_btn"},[s("div",{staticClass:"slidecontainer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.rate,expression:"rate"}],staticClass:"slider",attrs:{type:"range",step:.25,min:.25,max:2,id:"myRange"},domProps:{value:e.rate},on:{change:e.setSpeed,__r:function(t){e.rate=t.target.value}}})]),s("label",[e._v("speed")])]),s("div",{staticClass:"ctrl_btn"},[s("div",{staticClass:"slidecontainer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.volume,expression:"volume"}],staticClass:"slider",attrs:{type:"range",step:1,min:0,max:100,id:"myRange"},domProps:{value:e.volume},on:{change:e.setVolume,__r:function(t){e.volume=t.target.value}}})]),s("label",[e._v("volume")])])]):e._e()])])},w=[],b=s("1547"),y={props:["src"],mounted:function(){var e=this;this.mobile=b["a"].isNative,this.deleteClipboard(),setTimeout((function(){e.toggleVideoPlay,e.played=!0,console.log(e.played)}),2300)},beforeDestroy:function(){clearTimeout(this.setTimeOut),clearTimeout(this.setTimeOut2)},data:function(){return{played:!1,playing:!1,mobile:!1,setTimeOut:null,setTimeOut2:null,rate:1,volume:50,player:null}},computed:{watermark:function(){return this.$store.getters.adminData.watermark}},methods:{deleteClipboard:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.setTimeOut=setTimeout(Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.copyToClipboard("كان غيرك اشطر").then((function(e){})).catch((function(e){}));case 2:e.deleteClipboard();case 3:case"end":return t.stop()}}),t)}))),100);case 1:case"end":return t.stop()}}),t)})))()},copyToClipboard:function(e){if(this.mobile){var t=document.getElementById("textarea");t.value=e,t.select(),document.execCommand("copy")}if(void 0!=navigator.clipboard)return new Promise(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(s,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.writeText(e);case 3:s("copied"),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),n(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e,s){return t.apply(this,arguments)}}());if(window.clipboardData)return new Promise((function(t,s){window.clipboardData.setData("Text",e),t("copied2")}));var s=document.getElementById("textarea");return s.value=e,s.select(),document.body.removeChild(s),new Promise((function(e,t){document.execCommand("copy")?e("copied3"):t("error")}))},toggleVideoPlay:function(){var e=this.$refs.video;this.playing?(e.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*"),this.playing=!1):(console.log(e.contentWindow),e.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"*"),this.playing=!0)},setSpeed:function(){var e=+this.rate,t=document.getElementById("video"),s={event:"command",func:"setPlaybackRate",args:[e,!0]};t.contentWindow.postMessage(JSON.stringify(s),"*")},setVolume:function(){var e=+this.volume,t=document.getElementById("video"),s={event:"command",func:"setVolume",args:[e,!0]};t.contentWindow.postMessage(JSON.stringify(s),"*")},seekTo:function(){var e=document.getElementById("video"),t={event:"command",func:"seekTo",args:[200,!0]};e.contentWindow.postMessage(JSON.stringify(t),"*")},initialize:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s=html.replace("##src##",e.src.split("/embed/")[1]),n=e.htmlToDocument(s),e.updateIframe(n);case 3:case"end":return t.stop()}}),t)})))()},htmlToDocument:function(e){var t=new DOMParser,s=t.parseFromString(e,"text/html");return s},updateIframe:function(e){var t=this.$refs.frame,s=t.contentWindow.document;s.open(),s.write(e.documentElement.innerHTML),s.close()}}},x=y,_=(s("267b"),Object(v["a"])(x,p,w,!1,null,"cf005a4c",null)),C=_.exports,k={components:{DrawingBoard:g,VideoIframe:C},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return 1!=e.admin&&(e.stage=e.$store.getters.stage),t.next=3,l.a.get("/getYoutubeSecret");case 3:s=t.sent,e.youtubeSecret=s.data.youtubeSecret,e.getStageUsers(),Object(r["socket"])().on("live",(function(t){e.online=!0,e.live=!0,e.seconds=t.seconds,e.time=new Date(1e3*e.seconds-72e5).toString().split("1970")[1].split("GMT")[0]})),Object(r["socket"])().on("finish",(function(){console.log("finished "),e.online=!1,e.live=!1,e.time="00:00:00",e.seconds=0,1!=e.admin&&e.$router.replace("/")})),Object(r["socket"])().on("comment",(function(t){e.messages.push(t)})),Object(r["socket"])().on("new_user",(function(t){e.viewers.includes(t.userId)||e.viewers.push(t.userId)})),Object(r["socket"])().on("quited",(function(t){var s=e.viewers.findIndex((function(e){return e==t})),n=Object(o["a"])(e.viewers);n.splice(s,1),e.viewers=n})),Object(r["socket"])().on("not_allowed",(function(){e.$router.replace("/")})),1==e.admin&&(setInterval((function(){Object(r["socket"])().emit("getOnline")}),2e3),Object(r["socket"])().on("onlineUsers",(function(t){e.viewers=t})));case 13:case"end":return t.stop()}}),t)})))()},data:function(){return{stage:"6",live:!1,online:!1,seconds:0,time:"00:00:00",message:"",messages:[],stage_users:[],viewers:[],youtubeSecret:"",board:!1,userToDraw:null}},computed:{admin:function(){return this.$store.getters.role},username:function(){return this.$store.getters.username},userId:function(){return this.$store.getters.userId}},watch:{stage:function(e){}},methods:{startLive:function(){console.log(this.stage),Object(r["socket"])().emit("add_boradcaster",this.stage)},stopLive:function(){Object(r["socket"])().emit("stop",this.stage),this.time="00:00:00",this.seconds=0,this.messages=[]},sendMessage:function(){Object(r["socket"])().emit("do_comment",{name:this.username,text:this.message}),this.message=""},changeStage:function(){this.getStageUsers()},getStageUsers:function(){var e=this;1==this.admin&&l.a.get("/getStageUsers/"+this.stage).then((function(t){e.stage_users=t.data.users}))},isOnline:function(e){var t=this.viewers.includes(e)?"online":"offline";return t}},destroyed:function(){Object(r["socket"])().emit("quit",this.userId),1==this.admin&&this.stopLive()}},O=k,I=(s("bafb"),Object(v["a"])(O,n,i,!1,null,null,null));t["default"]=I.exports}}]);
//# sourceMappingURL=chunk-87a66044.5be5b8f3.js.map